"#!/bin/bash", "bucket=edwards-asadmin-patching-bucket-us-west-2", "instance_id=$(curl -s http://169.254.169.254/latest/meta-data/instance-id)", "echo $instance_id $bucket", "if type -t rpm >/dev/null 2>&1;then", " pkg_list=$(rpm -qa --queryformat '"%-30{NAME}": "%10{VERSION}-%20{RELEASE}",' | sed -e 's~,$~~' | tr -d ' ')", " echo "{${pkg_list}}" | \", " python -c 'import json, sys; print(json.dumps(json.loads(sys.stdin.read()), indent=4))' > pkg_list.json", " echo Retrieved package list from rpm", "fi", "if type -t dpkg >/dev/null 2>&1;then", " echo "Found debian"", "fi", "test -e pkg_list.json || echo unable to find pkg_list.json", "aws s3 cp pkg_list.json s3://$bucket/patching-state/2019-11-22/${instance_id}.json", "echo Completed Export"